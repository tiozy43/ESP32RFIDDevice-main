#include <NTPClient.h>
#include <WiFiUdp.h>
#include <ctime>
#include <WiFi.h>

// WiFi and NTP setup
const char* ssid = "TOPNET_9BC0";
const char* password = "EZATEAWA24";
WiFiUDP ntpUDP;
NTPClient timeClient(ntpUDP, "pool.ntp.org", 0, 60000); // Sync every 60 seconds

// Helper function to convert month number to text
String getMonthText(int month) {
    const char* months[] = {"JAN", "FEB", "MAR", "APR", "MAY", "JUN", 
                            "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"};
    return months[month - 1]; // month is 1-based
}

void setup() {
    Serial.begin(115200);
    // Connect to WiFi
    WiFi.begin(ssid, password);
    while (WiFi.status() != WL_CONNECTED) {
        delay(1000);
        Serial.println("Connecting to WiFi...");
    }
    Serial.println("Connected to WiFi");

    // Initialize NTP client
    timeClient.begin();
    timeClient.update();
}

void loop() {
    timeClient.update(); // Sync time

    // Get the epoch time
    unsigned long epochTime = timeClient.getEpochTime();

    // Convert epoch time to tm structure
    time_t rawtime = epochTime;  // Cast epoch time to time_t
    struct tm *timeinfo = localtime(&rawtime); // Convert to local time

    // Extract date and time components
    int hours = timeinfo->tm_hour; // Hours in 24-hour format
    int minutes = timeinfo->tm_min; // Minutes
    int day = timeinfo->tm_mday;    // Day of the month
    int month = timeinfo->tm_mon + 1; // Month (0-based, add 1)
    int year = timeinfo->tm_year + 1900; // Year (years since 1900)

    // Format date and time strings
    String dateStr = String(day) + " " + getMonthText(month) + " " + String(year);
    String timeStr = (hours < 10 ? "0" : "") + String(hours) + ":" + (minutes < 10 ? "0" : "") + String(minutes);

    // Print date and time
    Serial.println("Current Date: " + dateStr);
    Serial.println("Current Time: " + timeStr);

    delay(10000); // Update every 10 seconds
}
